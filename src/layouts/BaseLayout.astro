---
import GlobalStyles from '../components/GlobalStyles.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';
import ConsentBanner from '../components/ConsentBanner.astro';

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  currentPage?: string;
}

const {
  title,
  description = "MMT UK promotes better public understanding of money, economics and government spending for a fairer, sustainable society.",
  ogImage = "/images/Home.avif",
  currentPage = ''
} = Astro.props;

const siteUrl = Astro.site?.toString() || 'https://mmtuk.org';
const fullOgImage = ogImage.startsWith('http') ? ogImage : `${siteUrl}${ogImage}`;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{title} | MMT UK</title>
  <meta content={description} name="description">
  <meta content={`${title} | MMT UK`} property="og:title">
  <meta content={description} property="og:description">
  <meta content={fullOgImage} property="og:image">
  <meta content={`${title} | MMT UK`} property="twitter:title">
  <meta content={description} property="twitter:description">
  <meta content={fullOgImage} property="twitter:image">
  <meta property="og:type" content="website">
  <meta content="summary_large_image" name="twitter:card">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="/css/normalize.css" rel="stylesheet" type="text/css">
  <link href="/css/webflow.css" rel="stylesheet" type="text/css">
  <link href="/css/mmtuk.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">
    WebFont.load({
      google: {
        families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic"]
      }
    });
  </script>
  <script type="text/javascript">
    !function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);
  </script>
  <link href="/images/favicon.webp" rel="shortcut icon" type="image/x-icon">
  <link href="/images/webclip.webp" rel="apple-touch-icon">
  <style>
    * {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      -o-font-smoothing: antialiased;
    }
  </style>
</head>
<body class="body">
  <div class="page-wrapper">
    <GlobalStyles />
    <Navbar currentPage={currentPage} />
    <main class="main-wrapper">
      <slot />
    </main>
    <Footer />
  </div>
  <ConsentBanner />
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=68e4dbecc345c60bfa716be3" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="/js/webflow.js" type="text/javascript"></script>
  <script>
    (function () {
      var shareUrl = window.location.href;
      var encUrl = encodeURIComponent(shareUrl);
      var ogTitle = document.querySelector('meta[property="og:title"]');
      var shareTitle = encodeURIComponent(ogTitle ? ogTitle.content : document.title);
      var builders = {
        linkedin: function () { return "https://www.linkedin.com/sharing/share-offsite/?url=" + encUrl; },
        x: function () { return "https://x.com/intent/tweet?url=" + encUrl + "&text=" + shareTitle; },
        facebook: function () { return "https://www.facebook.com/sharer/sharer.php?u=" + encUrl; }
      };
      document.querySelectorAll('a[data-share]').forEach(function (a) {
        var net = a.getAttribute('data-share');
        if (builders[net]) {
          a.href = builders[net]();
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          a.setAttribute('aria-label', 'Share on ' + net.charAt(0).toUpperCase() + net.slice(1));
        }
      });
      function copyToClipboard(text) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          return navigator.clipboard.writeText(text);
        }
        return new Promise(function(resolve, reject){
          try {
            var ta = document.createElement('textarea');
            ta.value = text;
            ta.style.position = 'fixed';
            ta.style.opacity = '0';
            document.body.appendChild(ta);
            ta.focus();
            ta.select();
            var ok = document.execCommand('copy');
            document.body.removeChild(ta);
            ok ? resolve() : reject();
          } catch(e) { reject(e); }
        });
      }
      document.querySelectorAll('[data-copy="url"]').forEach(function (btn) {
        btn.addEventListener('click', function (e) {
          e.preventDefault();
          copyToClipboard(shareUrl)
            .then(function () {
              var original = btn.innerText;
              btn.innerText = 'Copied';
              btn.setAttribute('aria-live', 'polite');
              setTimeout(function(){ btn.innerText = original; }, 1500);
            })
            .catch(function () {
              window.open(shareUrl, '_blank');
            });
        });
        btn.setAttribute('aria-label', 'Copy page link');
        btn.href = '#';
      });
    })();
  </script>
</body>
</html>
